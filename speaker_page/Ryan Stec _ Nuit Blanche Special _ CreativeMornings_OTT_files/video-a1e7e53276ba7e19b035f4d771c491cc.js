(function(){window.QuoteForm=function(){function e(e,t){var n,i,r;r=this,i=$(".tag-quote-form"),n=$(document),n.on("click",".js-show-quote-form, .goto-add-quote",function(e){return e.preventDefault(),checkForGuest()?void 0:(i.slideToggle().toggleClass("is-visible"),$("#tag-quote-start").focus(),$(".upcoming-vid").fadeOut())}),n.on("keyup blur change",".time-field",function(){var e,t,n,i;return t=$(this),e=t.parents(".field").next(".field"),i=t.val(),n=/[a-zA-Z]+/,""===i||n.test(i)?void 0:e[0].classList.remove("is-inactive")}),n.on("keydown.quote",function(t){return e(t)}),n.on("blur","#tag-quote-text",function(){var e,t;return t=$(this),e=t.parents(".field").next(".field"),t.val().length>5?e[0].classList.remove("is-inactive"):e[0].classList.add("is-inactive")}).on("keyup","#tag-quote-text",function(){var e,t;return t=$(this),e=t.parents(".field").next(".field"),t.val().length>5?e[0].classList.remove("is-inactive"):e[0].classList.add("is-inactive")}),n.on("click",".get-quote-time",function(){return t(this)}),i.on("submit",function(){return i[0].classList.add("is-loading")}),i.on("ajax:success",function(e,t){var n;return i[0].classList.remove("is-loading"),t.success?(i.find(".message-success")[0].classList.remove("is-hidden"),i.find(".message-error")[0].classList.add("is-hidden"),i.find('input[type="text"], textarea').val(""),i.find(".field:not(.first)").addClass("is-inactive")):(n=i.find(".message-error")[0],n.classList.remove("is-hidden"),n.innerHTML=t.errors)}),i.on("ajax:error",function(){var e;return e=i.find(".message-error")[0],i.find(".message-success")[0].classList.add("is-hidden"),i[0].classList.remove("is-loading"),e.classList.remove("is-hidden"),e.innerHTML="There was an error while tagging this quote. Try again?"})}return e}()}).call(this),function(){var e,t,n,i,r,a,o,s,u,d,c,l,v,f,m,p,g,h,y,b,L,T,S,k,q,A,C,x,j,E,P;e=!1,a=navigator.userAgent.match(/(iPhone|iPod|iPad)/i),n=!1,d=null,l=!1,v=0,m=getQueryStringObject(),f=m.play?decodeURIComponent(m.play):"0:00",b=document.querySelectorAll(".vid-player").length,L=document.getElementsByClassName("vid")[0],T=!1,A=document.getElementById("main-video"),q=A.getAttribute("data-video-provider"),C=A.getAttribute("data-title"),k=A.getAttribute("data-video-id"),E=0,P=1,c=function(){return v++,v>=b&&(L.classList.add("is-ready"),l=!0,m.play)?(o(!1),updateURL(updatedQueryString({play:"clear"}),!0)):void 0},x=function(e,t){return{videoId:e,playerVars:{playlist:t,showinfo:0,rel:0,color:"white",iv_load_policy:3,enablejsapi:1,start:getSeconds(f)},events:{onReady:function(){return c()},onStateChange:function(e){return j(e)}}}},j=function(t){var i;return t.data!==YT.PlayerState.ENDED||-1!==E&&E!==P-1?t.data===YT.PlayerState.PLAYING&&(E=d.getPlaylistIndex(),n&&!e&&0===E&&(e=!0,i=A.getAttribute("data-bumper-title"),trackGoogleEvent("Bumper","Played",i)),"no"===L.getAttribute("data-has-time"))?h(d.getDuration()):void 0:S()},window.onYouTubeIframeAPIReady=function(){var e,t,i;return i=document.querySelector(".js-vid-embed"),t=i.getAttribute("data-video"),e=i.getAttribute("data-next"),e&&getSeconds(f)>0?(t=e,e=null):e&&(n=!0,P+=1),d=new YT.Player(i,x(t,e))},u=function(e){return e&&d.seekTo(getSeconds(e),!0),d.playVideo()},r=function(e){var t,n;return null==e&&(e="main"),L.classList.add("is-ready"),l=!0,(t=$(A).find("iframe")[0])?(n=$f(t),n.addEvent("ready",function(){return"ad"!==e&&c(),n.addEvent("finish",function(){return S()}),d=n})):void 0},s=function(e,t){return null==e&&(e=d),null==t&&(t="0:00"),e.api("paused",function(n){return n?(getSeconds(t)>0&&e.addEvent("play",function(){return e.api("seekTo",getSeconds(t))}),e.api("play")):e.api("seekTo",getSeconds(t))})},i=function(){var e;return e=document.querySelector(".vid-placeholder"),e&&e.addEventListener(transEndEventName,function(){return e.classList.add("is-hidden"),$(".event-vid-meta, .vid-play-ic, .event-vid-time").addClass("is-hidden")},!0),L.classList.add("is-playing")},o=function(e){var t,n;if(d){if(i(),$(".upcoming-vid").fadeOut(),!a)if(null==e&&(e=f),"youtube"===q)try{u(e)}catch(r){t=r,console.error("Error playing YouTube video. "+t.toString())}else s(d,e);return n=document.querySelector(".event-vid-actions"),null!=n&&n.classList.remove("is-visible"),A.classList.remove("is-hidden"),null!=C?trackGoogleEvent("Video","Played",C):void 0}},y=function(){return"youtube"===q?d.getPlayerState()===YT.PlayerState.PAUSED?d.playVideo():d.pauseVideo():d.api("paused",function(e){return e?d.api("play"):d.api("pause")})},S=function(){var e;return e=document.querySelector(".event-vid-actions"),null!=e&&e.classList.remove("is-visible"),A.classList.remove("is-hidden"),$(".upcoming-vid, .vid-promo").fadeIn(),$(".vid-promo__form").on("submit",function(e){var t,n;return e.preventDefault(),n=this,t=this.querySelector(".vid-promo__submit"),t.setAttribute("value","Loading..."),t.setAttribute("disabled","disabled"),$.ajax({url:n.getAttribute("action"),data:$(n).serializeArray(),type:"POST",dataType:"JSON"}).done(function(e){return"subscribed"===e.status?$(".vid-promo .vc").html("<p><strong>Success!</strong></p>"):void 0})})},t=function(){var e,t;return(t=document.getElementById("flickr-slider"))?(e=t.getAttribute("data-photoset"),$.ajax({url:"https://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key=fb782489cd51a4517123c42edf43ce18&per_page=15&photoset_id="+e+"&media=photos&extras=url_m,url_o&privacy_filter=1&format=json&nojsoncallback=1",type:"GET"}).done(function(e){var n,i,r,a,o,s,u;if(u=e.photoset.photo,u.length){for(i=document.createDocumentFragment(),r=0;r<u.length;)s=u[r],o=document.createElement("li"),n=document.createElement("a"),n.setAttribute("rel","gallery"),n.setAttribute("href",s.url_o),a=new Image,a.src=s.url_m,a.alt=s.title,n.appendChild(a),o.appendChild(n),i.appendChild(o),r++;return t.appendChild(i),$(".event-photos-slider a").colorbox({maxWidth:"90%",maxHeight:"95%",opacity:1}),$(".event-photos-slider").jcarousel({animation:250,transitions:{transforms:Modernizr.csstransforms,transforms3d:Modernizr.csstransforms3d,easing:"ease"}}),$(".slides-prev").jcarouselControl({target:"-=1"}).on("inactive.jcarouselcontrol",function(){return this.classList.add("inactive")}).on("active.jcarouselcontrol",function(){return this.classList.remove("inactive")}),$(".slides-next").jcarouselControl({target:"+=1"}).on("inactive.jcarouselcontrol",function(){return this.classList.add("inactive")}).on("active.jcarouselcontrol",function(){return this.classList.remove("inactive")})}})):void 0},h=function(e){return T?void 0:(T=!0,$.ajax({url:"/videos/"+k+"/time",data:{time:e},type:"PUT"}))},g=function(e){var t;return 9===e.keyCode&&e.shiftKey?(e.preventDefault(),"youtube"===q?(t=d.getCurrentTime()-6,0>t&&(t=0),o(t)):d.api("getCurrentTime",function(e){return t=e-6,0>t&&(t=0),o(t)})):13===e.keyCode&&e.shiftKey?(e.preventDefault(),y()):void 0},p=function(e){var t,n;return t=$(e),"youtube"===q?(n=formatTime(d.getCurrentTime()),t.parent().find("input").val(n).trigger("change").focus()):d.api("getCurrentTime",function(e){var i;return i=e,n=formatTime(e),t.parent().find("input").val(n).trigger("change").focus()})},$(function(){var e;return"vimeo"===q&&r("main"),e=document.querySelector(".featured-quote"),null!=e&&(f=e.getAttribute("data-time")),$document.on("click",".vid-placeholder, .vid-play-ic",function(e){return!$(e.target).closest(".featured-quote-actions").length&&l?(i(),o()):void 0}),$document.on("click",".play-quote-from-time",function(e){var t;return $(this).parents(".graphic-quote").length?void 0:(e.preventDefault(),t=$(this).data("time"),o(t),$.scrollTo(L,1e3))}),$document.on("mousedown",".goto-video-page",function(){var e,t;return e=$(this),"youtube"===q?(t=formatTime(d.getCurrentTime()),e.attr("href",e.attr("href")+"?play="+t)):d.api("getCurrentTime",function(n){var i;return i=n,t=formatTime(n),e.attr("href",e.attr("href")+"?play="+t)})}),new QuoteForm(g,p),$document.on("click",".goto-add-quote",function(){return $.scrollTo(L,1e3),i()}),$document.on("click",".upcoming-vid",function(e){var t;return t=$(e.target),t.hasClass("talk")||t.parents(".talk").length?void 0:$(".upcoming-vid").fadeOut()}),$(window).on("load",function(){return t()})})}.call(this);